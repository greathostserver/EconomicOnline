<section class="card">
  <h3 id="cryptoTitle">ارزهای دیجیتال</h3>
  <input type="text" id="cryptoSearch" placeholder="جستجو..." style="width:100%;padding:8px;margin:8px 0;">
  <div id="cryptoStatus">در حال بارگذاری...</div>
  <table id="cryptoTable" style="width:100%;border-collapse:collapse;">
    <thead>
      <tr>
        <th>نام</th><th>قیمت</th><th>تغییر 24h</th><th>مارکت کپ</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<script>
async function loadCryptoTable(){
  const status=document.getElementById('cryptoStatus');
  const tbody=document.querySelector('#cryptoTable tbody');
  try{
    status.textContent='در حال دریافت داده‌ها...';
    const url='https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=100&page=1';
    const res=await fetch(url);
    const data=await res.json();
    tbody.innerHTML=data.map(c=>{
      const cls=c.price_change_percentage_24h>=0?'delta-up':'delta-down';
      return `<tr>
        <td><img src="${c.image}" width="20"> ${c.name} (${c.symbol.toUpperCase()})</td>
        <td>$${c.current_price.toLocaleString()}</td>
        <td class="${cls}">${c.price_change_percentage_24h.toFixed(2)}%</td>
        <td>$${c.market_cap.toLocaleString()}</td>
      </tr>`;
    }).join('');
    status.textContent='لیست آماده است';
    // جستجو
    document.getElementById('cryptoSearch').addEventListener('input',e=>{
      const q=e.target.value.toLowerCase();
      [...tbody.rows].forEach(r=>{
        r.style.display=r.textContent.toLowerCase().includes(q)?'':'none';
      });
    });
  }catch(e){
    status.textContent='خطا در دریافت داده‌ها';
  }
}
document.addEventListener('DOMContentLoaded',loadCryptoTable);
</script>
